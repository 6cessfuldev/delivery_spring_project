<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "https://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.ezen.delivery.repository.ReviewDAO">

<select id="selectReview" resultType="com.ezen.delivery.domain.ReviewVO">
	select * from review where review_diner_code=#{diner_code}
</select>

<insert id="insertReview" parameterType="com.ezen.delivery.domain.ReviewVO">
	<selectKey keyProperty="review_code" resultType="int" order="BEFORE">
	      SELECT IFNULL(MAX(review_code+1),1) from review
	</selectKey>
	insert into review (review_code, review_diner_code,review_user_id,review_content,review_score)
	values (#{review_code},#{review_diner_code},#{review_user_id}, #{review_content}, #{review_score})
</insert>

<select id="selectAvgStar" resultType="double">
	select avg(review_score) from review where review_diner_code = #{diner_code};
</select>
</mapper>