<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "https://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.ezen.delivery.repository.DinerDAO">

<select id="selectListAll" resultType="com.ezen.delivery.domain.DinerVO">
	select * from diner order by diner_code desc;
</select>

<select id="selectListFirst" resultType="com.ezen.delivery.domain.DinerVO">
	select * from diner limit 0, 20
</select>

<select id="selectList" parameterType="com.ezen.delivery.domain.PagingVO" resultType="com.ezen.delivery.domain.DinerVO">
	select diner_code, file_code, diner_name, diner_address, diner_min_pay, diner_notice, diner_open_time, diner_close_time, diner_method_pay,
			diner_business_name, diner_company_num, diner_category, diner_delivery_fee, ST_X(diner_addr_point) as diner_addr_lng, ST_Y(diner_addr_point) as diner_addr_lat from diner 
			order by ST_Distance_Sphere(diner_addr_point, point(#{lng}, #{lat})) limit #{startNum}, 10 
</select>

<select id="selectListbyCate" parameterType="com.ezen.delivery.domain.PagingVO" resultType="com.ezen.delivery.domain.DinerVO">
	select diner_code, file_code, diner_name, diner_address, diner_min_pay, diner_notice, diner_open_time, diner_close_time, diner_method_pay,
			diner_business_name, diner_company_num, diner_category, diner_delivery_fee, ST_X(diner_addr_point) as diner_addr_lng, ST_Y(diner_addr_point) as diner_addr_lat from diner 
			where diner_category like concat('%', #{category}, '%') order by ST_Distance_Sphere(diner_addr_point, point(#{lng}, #{lat})) limit #{startNum}, 10 
</select>

<insert id="insert">
insert into diner(file_code, diner_name, diner_address, diner_min_pay, diner_notice, diner_open_time, diner_close_time, diner_method_pay,
			 diner_business_name, diner_company_num, diner_category, diner_delivery_fee, diner_addr_point)
		value(#{file_code}, #{diner_name}, #{diner_address}, #{diner_min_pay}, #{diner_notice}, #{diner_open_time}, #{diner_close_time}, 
			#{diner_method_pay}, #{diner_business_name}, #{diner_company_num}, #{diner_category}, #{diner_delivery_fee}, POINT(#{diner_addr_lng}, #{diner_addr_lat}))
</insert>

<select id="selectDiner" resultType="com.ezen.delivery.domain.DinerVO">
	select diner_code, file_code, diner_name, diner_address, diner_min_pay, diner_notice, diner_open_time, diner_close_time, diner_method_pay,
			diner_business_name, diner_company_num, diner_category, diner_delivery_fee, ST_X(diner_addr_point) as diner_addr_lng, ST_Y(diner_addr_point) as diner_addr_lat from diner where diner_code = #{diner_code}
</select>

<update id="update">
	update diner set file_code=#{file_code}, diner_name=#{diner_name}, diner_address=#{diner_address}, diner_min_pay=#{diner_min_pay}, diner_notice=#{diner_notice}, 
			diner_open_time=#{diner_open_time}, diner_close_time=#{diner_close_time}, diner_method_pay=#{diner_method_pay}, diner_business_name=#{diner_business_name}, 
			diner_company_num=#{diner_company_num}, diner_category=#{diner_category}, diner_delivery_fee=#{diner_delivery_fee}, diner_addr_point=POINT(#{diner_addr_lng}, #{diner_addr_lat}) where diner_code=#{diner_code}
</update>

<delete id="delete">
	delete from diner where diner_code = #{diner_code}
</delete>
</mapper>